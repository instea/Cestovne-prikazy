# Trips management

Application for management of trips.

## Getting Started

### Prerequisites

* node
* yarn
* docker, docker-compose (for database)

### Installing

Clone the repository
```
git clone https://github.com/instea/Cestovne-prikazy.git ; cd Cestovne-prikazy
```

Start by installing the dependencies:

```
yarn install
```

The application needs a running Mongo instance for it to work. It can be pointed to any such instance.
It can be set by setting the environment variable _MONGO\_URL_ to an url in this format:

```
mongodb://user:pass@localhost:port/database
```

If no mongo instance is readily available, the repository contains a docker compose file to quickly start a new instance:

```
pushd db
docker-compose up -d
popd
```

No authentication will be used by default. If it is required, read instructions at [mongo docker page](https://hub.docker.com/_/mongo/).

The application also requires some secret files that are not present in the repository:
* secrets/key.pem - private and public key

Those can be generated by running:

```
openssl genrsa -out ./secrets/key.pem 2048
```

and then extracting the Base64 content into private.key and public.pem files.

## Setup DB

If using the dockerized mongo instance with no authentication, the setup db and initial user by this command:

```
yarn server --fill-db
```

Otherwise, mongo url needs to be set:

```
MONGO_URL=mongodb://user:pass@localhost:port/database yarn server --fill-db
```

## Running
If using the dockerized mongo instance with no authentication, the server can be run by this command:

```
yarn server
```

Otherwise, mongo url needs to be set:

```
MONGO_URL=mongodb://user:pass@localhost:port/database yarn server
```

In both cases, following environmental variables are used to generate and send emails. When some of SMTP options are not set, emails are not sent. 
```
SMTP_HOST
SMTP_PORT
SMTP_USER
SMTP_PASSWORD
BASE_URL - root url of frontend webpage
APPROVAL_MAIL_RECEIVER - email address to send emails about new leaves to
MAIL_SENDER - name of email sender
```

You need to run the client and server application. Client side is run by issuing yarn start command:

```
yarn start
```

Login with initial user **admin / passw0rd**

## Running the tests

```
yarn test
```

### Coding style tests

The project uses ESLint for docing style tests. You can run them by:

```
yarn lint
```

Automatic fixing can be done by running:

```
yarn format
```

## Deployment



## See also

[Subproject for leaves management](angular/README.md)

## Built With

* [create-react-app](https://github.com/facebookincubator/create-react-app)
  * React - Web application framework
  * Webpack - build system
* [MongoDB](https://www.mongodb.com/) - NoSQL database
* [Mongoose](http://mongoosejs.com/) - ORM library for MongoDB in javascript
* [express](https://expressjs.com/) - Back-end web framework
* [express-graphql](https://github.com/graphql/express-graphql) - GraphQL server
* [apollo-client](https://github.com/apollographql/apollo-client) - GraphQL client
